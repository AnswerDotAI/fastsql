# Source


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L22"
target="_blank" style="float:right; font-size:smaller">source</a>

### Default

``` python

def Default(
    args:VAR_POSITIONAL, kwargs:VAR_KEYWORD
):

```

*Initialize self. See help(type(self)) for accurate signature.*

## [`Database`](https://answerdotai.github.io/fastsql/core.html#database) and [`DBTable`](https://answerdotai.github.io/fastsql/core.html#dbtable)

We create a
[`Database`](https://answerdotai.github.io/fastsql/core.html#database)
class and a
[`DBTable`](https://answerdotai.github.io/fastsql/core.html#dbtable)
class (which is returned by
[`Database.create`](https://answerdotai.github.io/fastsql/core.html#database.create)),
using sqlalchemy v2. These classes will allow us to directly work with
dataclasses such as these:

``` python
conn_str = _db_str(":memory:"); conn_str
```

    'sqlite:///:memory:'

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L39"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database

``` python

def Database(
    conn_str, engine_kws:NoneType=None
):

```

*A connection to a SQLAlchemy database*

``` python
db = Database(conn_str); db
```

    Database(sqlite:///:memory:)

``` python
# create a test table
db.execute(sa.text('create table test (id integer primary key, name text, age integer)'))
db.meta.reflect(bind=db.engine)
```

``` python
db.meta.tables
```

    FacadeDict({'test': Table('test', MetaData(), Column('id', INTEGER(), table=<test>, primary_key=True), Column('name', TEXT(), table=<test>), Column('age', INTEGER(), table=<test>), schema=None)})

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L61"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.q

``` python

def q(
    sql:str, params:VAR_KEYWORD
):

```

*Query database with raw SQL and optional parameters. Returns list of
dicts.*

``` python
# add some data to it
db.q('insert into test (name, age) values (:name, :age)', name='Alice', age=30)
db.q('insert into test (name, age) values (:name, :age)', name='Bob', age=25)
```

    []

``` python
db.q('select * from test')
```

    [{'id': 1, 'name': 'Alice', 'age': 30}, {'id': 2, 'name': 'Bob', 'age': 25}]

``` python
# update Alice's age to 32
db.q('update test set age = :age where name = :name', age=32, name='Alice')
```

    []

``` python
db.q('select * from test')
```

    [{'id': 1, 'name': 'Alice', 'age': 32}, {'id': 2, 'name': 'Bob', 'age': 25}]

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L69"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable

``` python

def DBTable(
    table:Table, db:Database, cls, _exists:NoneType=None
):

```

*A connection to a SQLAlchemy table, created if needed*

``` python
# create a DBTable with the Test table
tbl = DBTable(db.meta.tables['test'], db, None)
tbl
```

    <Table test (id, name, age)>

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L98"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.t

``` python

def t(
    
):

```

``` python
tbl.t
```

    (Table('test', MetaData(), Column('id', INTEGER(), table=<test>, primary_key=True), Column('name', TEXT(), table=<test>), Column('age', INTEGER(), table=<test>), schema=None),
     <sqlalchemy.sql.base.ReadOnlyColumnCollection>)

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L104"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.pks

``` python

def pks(
    
):

```

``` python
tbl.pks
```

    (Column('id', INTEGER(), table=<test>, primary_key=True),)

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L110"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.schema

``` python

def schema(
    
):

```

``` python
print(tbl.schema)
```

    CREATE TABLE test (
        id INTEGER, 
        name TEXT, 
        age INTEGER, 
        PRIMARY KEY (id)
    )

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L116"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.table

``` python

def table(
    nm:str, cls:NoneType=None
):

```

``` python
db.table('test')
```

    <Table test (id, name, age)>

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L139"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.\_\_getitem\_\_

``` python

def __getitem__(
    nm:str
):

```

``` python
db['test']
```

    <Table test (id, name, age)>

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L144"
target="_blank" style="float:right; font-size:smaller">source</a>

### database

``` python

def database(
    path, wal:bool=True, kwargs:VAR_KEYWORD
)->Any:

```

*Create a
[`Database`](https://answerdotai.github.io/fastsql/core.html#database)
from a path or connection string*

``` python
db = database("sqlite:///:memory:"); db
```

    Database(sqlite:///:memory:)

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L182"
target="_blank" style="float:right; font-size:smaller">source</a>

### create_mod

``` python

def create_mod(
    db, mod_fn, with_views:bool=False, store:bool=True, suf:str=''
):

```

*Create module for dataclasses for `db`*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L177"
target="_blank" style="float:right; font-size:smaller">source</a>

### all_dcs

``` python

def all_dcs(
    db, with_views:bool=False, store:bool=True, suf:str=''
):

```

*dataclasses for all objects in `db`*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L213"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.get_tables

``` python

def get_tables(
    glb
):

```

*Add objects for all table objects to namespace `glb`*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L206"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.set_classes

``` python

def set_classes(
    glb
):

```

*Add set all table dataclasses using types in namespace `glb`*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L199"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.link_dcs

``` python

def link_dcs(
    mod
):

```

*Set the internal dataclass type links for tables using `mod` (created
via
[`create_mod`](https://answerdotai.github.io/fastsql/core.html#create_mod))*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L221"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.lookup

``` python

def lookup(
    lookup_values:Dict, extra_values:Optional=None, pk:str | None='id', kwargs:VAR_KEYWORD
):

```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L244"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.upsert

``` python

def upsert(
    record:Any=None, pk:Default=<__main__.Default object at 0x7fe1bb4866f0>,
    foreign_keys:Default=<__main__.Default object at 0x7fe1bb4866f0>,
    column_order:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    not_null:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    defaults:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    hash_id:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    hash_id_columns:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    alter:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    extracts:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    conversions:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    columns:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    strict:Union=<__main__.Default object at 0x7fe1bb4866f0>, kwargs:VAR_KEYWORD
)->Any:

```

## CRUD Operations

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L317"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_typ

``` python

def get_typ(
    t
):

```

*Get the underlying type.*

``` python
get_typ(int|None), get_typ(list[str])
```

    (int, str)

``` python
_sa_type(int)
```

    sqlalchemy.sql.sqltypes.Integer

``` python
_column('age', int)
```

    Column('age', Integer(), table=None)

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L349"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.create

``` python

def create(
    cls:type, pk:str='id', name:str | None=None, foreign_keys:NoneType=None, defaults:NoneType=None,
    column_order:NoneType=None, not_null:NoneType=None, hash_id:NoneType=None, hash_id_columns:NoneType=None,
    extracts:NoneType=None, if_not_exists:bool=False, replace:bool=False, ignore:bool=True, transform:bool=False,
    strict:bool=False, constraints:NoneType=None
):

```

*Get a table object, creating in DB if needed*

``` python
class User: name:str; pwd:str
class Todo: title:str; name:str; id:int; done:bool=False; details:str=''
class Student: id:int; grad_year:int; name:str
```

``` python
users = db.create(User, pk='name')
todos = db.create(Todo, pk='id')
students = db.create(Student, pk=('id', 'grad_year'))
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L399"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.view_names

``` python

def view_names(
    
):

```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L394"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.table_names

``` python

def table_names(
    
):

```

``` python
db.table_names()
```

    ['student', 'todo', 'user']

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L405"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.schema

``` python

def schema(
    
):

```

*Show all tables and columns*

``` python
print(db.schema())
```

    Table: student
      * id: INTEGER
      * grad_year: INTEGER
      - name: VARCHAR
    Table: todo
      - title: VARCHAR
      - name: VARCHAR
      * id: INTEGER
      - done: BOOLEAN
      - details: VARCHAR
    Table: user
      * name: VARCHAR
      - pwd: VARCHAR

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L444"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.t

``` python

def t(
    
):

```

By returning a
[`_TablesGetter`](https://answerdotai.github.io/fastsql/core.html#_tablesgetter)
we get a repr and auto-complete that shows all tables in the DB.

``` python
db.t
```

    student, todo, user

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L478"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.c

``` python

def c(
    
):

```

Similarly, we return
[`_ColsGetter`](https://answerdotai.github.io/fastsql/core.html#_colsgetter)
for a tableâ€™s columns

``` python
users.c
```

    name, pwd

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L490"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.create

``` python

def create(
    columns:Dict=None, pk:Any=None, foreign_keys:NoneType=None, column_order:Optional=None, not_null:Optional=None,
    defaults:Optional=None, hash_id:str | None=None, hash_id_columns:Optional=None, extracts:Union=None,
    if_not_exists:bool=False, replace:bool=False, ignore:bool=False, transform:bool=False, strict:bool=False,
    kwargs:VAR_KEYWORD
):

```

*Create table from column definitions passed as kwargs or columns dict*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L484"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.exists

``` python

def exists(
    
):

```

*Check if this table exists in the DB*

``` python
users.exists()
```

    True

``` python
u0 = User('jph','foo')
u1 = User('rlt','bar')
t0 = Todo('do it', 'jph')
t1 = Todo('get it done', 'rlt')
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L574"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.insert

``` python

def insert(
    record:Dict=None, pk:Default=<__main__.Default object at 0x7fe1bb4866f0>,
    foreign_keys:Default=<__main__.Default object at 0x7fe1bb4866f0>,
    column_order:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    not_null:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    defaults:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    hash_id:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    hash_id_columns:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    alter:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    ignore:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    replace:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    extracts:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    conversions:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    columns:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    strict:Union=<__main__.Default object at 0x7fe1bb4866f0>, kwargs:VAR_KEYWORD
)->Any:

```

*Insert an object into this table, and return it*

``` python
t = todos.insert(t0)
assert t.id
t
```

    Todo(title='do it', name='jph', id=1, done=False, details='')

``` python
u = users.insert(u0)
assert u.name=='jph'
users.insert(u1)
u
```

    User(name='jph', pwd='foo')

``` python
todos.insert(t1)
```

    Todo(title='get it done', name='rlt', id=2, done=False, details='')

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L608"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.insert_all

``` python

def insert_all(
    records:Optional=None, pk:Default=<__main__.Default object at 0x7fe1bb4866f0>,
    foreign_keys:Default=<__main__.Default object at 0x7fe1bb4866f0>,
    column_order:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    not_null:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    defaults:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    batch_size:Default=<__main__.Default object at 0x7fe1bb4866f0>,
    hash_id:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    hash_id_columns:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    alter:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    ignore:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    replace:Union=<__main__.Default object at 0x7fe1bb4866f0>, truncate:bool=False,
    extracts:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    conversions:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    columns:Union=<__main__.Default object at 0x7fe1bb4866f0>,
    strict:Union=<__main__.Default object at 0x7fe1bb4866f0>, upsert:bool=False, analyze:bool=False,
    xtra:dict | None=None, kwargs:VAR_KEYWORD
)->DBTable:

```

``` python
todos.insert_all([t0,t1])
```

    <Table todo (title, name, id, done, details)>

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L693"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.count_where

``` python

def count_where(
    where:Optional=None, where_args:Union=None, kw:VAR_KEYWORD
)->int:

```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L706"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.count

``` python

def count(
    
):

```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L712"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.\_\_len\_\_

``` python

def __len__(
    
):

```

``` python
todos.count, len(todos)
```

    (4, 4)

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L718"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.rows_where

``` python

def rows_where(
    where:Optional=None, where_args:Union=None, order_by:Optional=None, select:str='*', limit:Optional=None,
    offset:Optional=None, xtra:dict | None=None, kw:VAR_KEYWORD
)->Generator:

```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L743"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.pks_and_rows_where

``` python

def pks_and_rows_where(
    where:Optional=None, where_args:Union=None, order_by:Optional=None, select:str='*', limit:Optional=None,
    offset:Optional=None, xtra:dict | None=None, kw:VAR_KEYWORD
)->Generator:

```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L772"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.rows

``` python

def rows(
    
):

```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L776"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.\_\_call\_\_

``` python

def __call__(
    where:str | None=None, # SQL where fragment to use, for example `id > ?`
    where_args:Union=None, # Parameters to use with `where`; iterable for `id>?`, or dict for `id>:id`
    order_by:str | None=None, # Column or fragment of SQL to order by
    limit:int | None=None, # Number of rows to limit to
    offset:int | None=None, # SQL offset
    select:str='*', # Comma-separated list of columns to select
    with_pk:bool=False, # Return tuple of (pk,row)?
    as_cls:bool=True, # Convert returned dict to stored dataclass?
    xtra:dict | None=None, # Extra constraints
    kw:VAR_KEYWORD
):

```

*Result of `select` query on the table. Returns list of returned
objects.*

``` python
assert users()==[u0,u1]
users()
```

    [User(name='jph', pwd='foo'), User(name='rlt', pwd='bar')]

``` python
r = users(where="pwd LIKE :pwd", pwd="b%")
assert r==[u1]
r
```

    [User(name='rlt', pwd='bar')]

``` python
users.xtra(name='rlt')
users(order_by='name')
```

    [User(name='rlt', pwd='bar')]

``` python
users(where='name="rlt"')
```

    [User(name='rlt', pwd='bar')]

``` python
users(where='name="jph"')
```

    []

``` python
assert len(todos())==4
todos()
```

    [Todo(title='do it', name='jph', id=1, done=False, details=''),
     Todo(title='get it done', name='rlt', id=2, done=False, details=''),
     Todo(title='do it', name='jph', id=3, done=False, details=''),
     Todo(title='get it done', name='rlt', id=4, done=False, details='')]

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L800"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.create_view

``` python

def create_view(
    name:str, sql:str, ignore:bool=False, replace:bool=False
):

```

*Create a view with the given name and SQL query*

``` python
# Create a view showing only incomplete todos
db.create_view('pending_todos', 'SELECT * FROM todo WHERE done = 0')
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L814"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.v

``` python

def v(
    
):

```

``` python
db.v.pending_todos()
```

    [{'title': 'do it', 'name': 'jph', 'id': 1, 'done': False, 'details': ''},
     {'title': 'get it done',
      'name': 'rlt',
      'id': 2,
      'done': False,
      'details': ''},
     {'title': 'do it', 'name': 'jph', 'id': 3, 'done': False, 'details': ''},
     {'title': 'get it done',
      'name': 'rlt',
      'id': 4,
      'done': False,
      'details': ''}]

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L829"
target="_blank" style="float:right; font-size:smaller">source</a>

### MissingPrimaryKey

``` python

def MissingPrimaryKey(
    args:VAR_POSITIONAL, kwargs:VAR_KEYWORD
):

```

*Common base class for all non-exit exceptions.*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L828"
target="_blank" style="float:right; font-size:smaller">source</a>

### NotFoundError

``` python

def NotFoundError(
    args:VAR_POSITIONAL, kwargs:VAR_KEYWORD
):

```

*Common base class for all non-exit exceptions.*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L856"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.\_\_getitem\_\_

``` python

def __getitem__(
    key
):

```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L833"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.get

``` python

def get(
    pk_values, as_cls:bool=True, xtra:dict | None=None, default:Any=UNSET
)->Any:

```

*Get item with PK `key`*

``` python
users.xtra(name='jph')
assert users['jph']==u0
users['jph']
```

    User(name='jph', pwd='foo')

``` python
users.xtra(name='rlt')
test_fail(lambda: users['jph']==u0)
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L861"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.selectone

``` python

def selectone(
    where:str | None=None, where_args:Union=None, select:str='*', as_cls:bool=True, xtra:dict | None=None,
    kwargs:VAR_KEYWORD
):

```

``` python
users.xtra()  # clear xtra
test_eq(users.selectone('name=?', ['jph']).name, 'jph')
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L886"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.update

``` python

def update(
    updates:dict | None=None, pk_values:list | tuple | str | int | float | None=None, alter:bool=False,
    conversions:dict | None=None, xtra:dict | None=None, kwargs:VAR_KEYWORD
)->Any:

```

``` python
users.xtra(name='jph')
u.pwd = 'new'
users.update(u)
users.xtra()
users()
```

    [User(name='jph', pwd='new'), User(name='rlt', pwd='bar')]

``` python
users.xtra(name='rlt')
u.pwd = 'foo'
users.update(u)
users.xtra()
test_eq(users['jph'].pwd, 'new')
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L929"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.update_where

``` python

def update_where(
    updates:dict, where:str | None=None, where_args:Union=None, xtra:dict | None=None, kw:VAR_KEYWORD
)->list:

```

*Update rows matching `where` with `updates`. Returns updated rows.*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L929"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.update_where

``` python

def update_where(
    updates:dict, where:str | None=None, where_args:Union=None, xtra:dict | None=None, kw:VAR_KEYWORD
)->list:

```

*Update rows matching `where` with `updates`. Returns updated rows.*

``` python
todos.update_where({'done': True}, where='name = :name', name='jph')
```

    [Todo(title='do it', name='jph', id=1, done=True, details=''),
     Todo(title='do it', name='jph', id=3, done=True, details='')]

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L950"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.delete

``` python

def delete(
    key
):

```

*Delete item with PK `key` and return the deleted object*

``` python
assert users.delete('jph')
test_fail(lambda: users['jph'])
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L962"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.delete_where

``` python

def delete_where(
    where:Optional=None, where_args:Union=None, xtra:dict | None=None, kw:VAR_KEYWORD
):

```

``` python
todos.delete_where("name = ?", ["jph"])
```

    [Todo(title='do it', name='jph', id=1, done=True, details=''),
     Todo(title='do it', name='jph', id=3, done=True, details='')]

``` python
todos('name=?', ['jph'])
```

    []

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L978"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.\_\_contains\_\_

``` python

def __contains__(
    pk_values:Union
)->bool: # A single value, or a tuple of values for tables that have a compound primary key

```

*Is the item with the specified primary key value in this table?*

Demonstration with single field primary key:

``` python
assert not 'jph' in users
assert 'rlt' in users
```

For compound primary keys, lets whether a student is in the students
table or not.

``` python
students.insert(Student(1, 2021, 'jph'))
```

    Student(id=1, grad_year=2021, name='jph')

``` python
assert (1,2021) in students
assert (1,2030) not in students
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L994"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.drop

``` python

def drop(
    ignore:bool=False
):

```

*Drop this table from the database*

``` python
students.drop()
assert 'student' not in db.t
```

## Migrations

``` python
db.t
```

    todo, user

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1005"
target="_blank" style="float:right; font-size:smaller">source</a>

### Meta

``` python

def Meta(
    args:VAR_POSITIONAL, kwargs:VAR_KEYWORD
):

```

*Initialize self. See help(type(self)) for accurate signature.*

``` python
db._add_meta(); db.t
```

    _meta, todo, user

``` python
print(db['_meta'].schema)
```

    CREATE TABLE _meta (
        id INTEGER, 
        version INTEGER, 
        PRIMARY KEY (id), 
        CHECK (id = 1)
    )

``` python
db['_meta']()
```

    [Meta(id=1, version=0)]

``` python
db.version
```

    0

``` python
db.version = 1; db.version
```

    1

``` python
mdir = Path('./migrations')
_get_migrations(mdir)
```

    [(1, Path('migrations/1-add_priority_and_due_date_to_todo.sql'))]

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1034"
target="_blank" style="float:right; font-size:smaller">source</a>

### Database.migrate

``` python

def migrate(
    mdir
):

```

``` python
db.version = 0
```

``` python
db.migrate(mdir)
test_eq(db.version, 1)
assert 'priority' in db.t.todo.c
assert 'due_date' in db.t.todo.c
```

    Applied migration 1: 1-add_priority_and_due_date_to_todo.sql

``` python
db.t.todo()
```

    [Todo(title='get it done', name='rlt', id=2, done=False, details='', priority=0, due_date=None),
     Todo(title='get it done', name='rlt', id=4, done=False, details='', priority=0, due_date=None)]

## SQLAlchemy helpers

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1073"
target="_blank" style="float:right; font-size:smaller">source</a>

### ReadOnlyColumnCollection.\_\_dir\_\_

``` python

def __dir__(
    
):

```

*Default dir() implementation.*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1068"
target="_blank" style="float:right; font-size:smaller">source</a>

### MetaData.\_\_dir\_\_

``` python

def __dir__(
    
):

```

*Default dir() implementation.*

``` python
dbm = db.meta
```

``` python
' '.join(dbm.tables)
```

    '_meta todo user'

``` python
t = dbm.todo
```

``` python
list(t.c)
```

    [Column('title', VARCHAR(), table=<todo>),
     Column('name', VARCHAR(), table=<todo>),
     Column('id', INTEGER(), table=<todo>, primary_key=True),
     Column('done', BOOLEAN(), table=<todo>),
     Column('details', VARCHAR(), table=<todo>),
     Column('priority', INTEGER(), table=<todo>, server_default=DefaultClause(<sqlalchemy.sql.elements.TextClause object>, for_update=False)),
     Column('due_date', TEXT(), table=<todo>)]

``` python
from sqlalchemy.exc import ResourceClosedError
```

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1107"
target="_blank" style="float:right; font-size:smaller">source</a>

### MetaData.sql

``` python

def sql(
    statement, args:VAR_POSITIONAL, kwargs:VAR_KEYWORD
):

```

*Execute `statement` string and return `DataFrame` of results (if any)*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1096"
target="_blank" style="float:right; font-size:smaller">source</a>

### Connection.sql

``` python

def sql(
    statement, nm:str='Row', args:VAR_POSITIONAL, kwargs:VAR_KEYWORD
):

```

*Execute `statement` string and return results (if any)*

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1088"
target="_blank" style="float:right; font-size:smaller">source</a>

### CursorResult.tuples

``` python

def tuples(
    nm:str='Row'
):

```

*Get all results as named tuples*

``` python
# dbm.sql('delete from todo')
# db.conn.commit()
```

``` python
rs = dbm.sql('select * from user')
rs[0]
```

    Row(name='rlt', pwd='foo')

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1114"
target="_blank" style="float:right; font-size:smaller">source</a>

### Table.get

``` python

def get(
    where:NoneType=None, limit:NoneType=None
):

```

*Select from table, optionally limited by `where` and `limit` clauses*

``` python
t.get(t.c.title.startswith('d'), limit=5)
```

    []

This is the query that will run behind the scenes:

``` python
print(t.select().where(t.c.title.startswith('d')).limit(5))
```

    SELECT todo.title, todo.name, todo.id, todo.done, todo.details, todo.priority, todo.due_date 
    FROM todo 
    WHERE (todo.title LIKE :title_1 || '%')
     LIMIT :param_1

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#L1121"
target="_blank" style="float:right; font-size:smaller">source</a>

### MetaData.close

``` python

def close(
    
):

```

*Close the connection*

``` python
dbm.close()
```
